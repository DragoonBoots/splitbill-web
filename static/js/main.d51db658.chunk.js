(this["webpackJsonpsplitbill-web"]=this["webpackJsonpsplitbill-web"]||[]).push([[0],{62:function(e,t,a){},63:function(e,t,a){},85:function(e,t,a){"use strict";a.r(t);var n=a(2),l=a(0),c=a.n(l),r=a(19),i=a.n(r),s=(a(62),a(36)),o=a(22),d=a(38),j=a(34),u=a(12),b=a(18),h=a(24),x=(a(63),a(95)),m=a(92),O=a(93),p=a(53),v=a(94),f=a(90),y=a(96),g=a(88),k=a(91),N=a(8),w=a(11),R=a(89);function T(e){return Object(n.jsxs)(g.a,Object(w.a)(Object(w.a)({},e),{},{variant:"outline-secondary",children:[Object(n.jsx)("span",{className:"sr-only",children:"Move up"}),Object(n.jsx)("i",{className:"bi-arrow-up-circle-fill"})]}))}function S(e){return Object(n.jsxs)(g.a,Object(w.a)(Object(w.a)({},e),{},{variant:"outline-secondary",children:[Object(n.jsx)("span",{className:"sr-only",children:"Move down"}),Object(n.jsx)("i",{className:"bi-arrow-down-circle-fill"})]}))}function _(e){return Object(n.jsxs)(g.a,Object(w.a)(Object(w.a)({},e),{},{variant:"outline-success",children:[Object(n.jsx)("span",{className:"sr-only",children:"Insert below"}),Object(n.jsx)("i",{className:"bi-plus-circle-fill"})]}))}function C(e){return Object(n.jsxs)(g.a,Object(w.a)(Object(w.a)({},e),{},{variant:"outline-danger",children:[Object(n.jsx)("span",{className:"sr-only",children:"Remove"}),Object(n.jsx)("i",{className:"bi-x-circle-fill"})]}))}var D=function(e){return Object(n.jsxs)(R.a,{children:[Object(n.jsx)(T,{disabled:0===e.index,onClick:function(){return e.arrayHelpers.move(e.index,e.index-1)}}),Object(n.jsx)(S,{disabled:e.index===e.values.length-1,onClick:function(){return e.arrayHelpers.move(e.index,e.index+1)}}),Object(n.jsx)(_,{onClick:function(){return e.arrayHelpers.insert(e.index+1,e.values[e.index])}}),Object(n.jsx)(C,{disabled:1===e.values.length,onClick:function(){return e.arrayHelpers.remove(e.index)}})]})};function I(e){return Object(n.jsxs)("div",{children:[Object(n.jsx)(N.b,{as:v.a.Control,name:"lines.".concat(e.index,".name"),type:"text"}),Object(n.jsx)(N.a,{name:"lines.".concat(e.index,".name"),component:"div",className:"field-error"})]})}function B(e){return Object(n.jsxs)("div",{children:[Object(n.jsxs)(f.a,{children:[Object(n.jsx)(f.a.Prepend,{children:Object(n.jsx)(f.a.Text,{children:"$"})}),Object(n.jsx)(N.b,{as:v.a.Control,name:"lines.".concat(e.index,".amount"),type:"number",min:"0",step:"0.01"})]}),Object(n.jsx)(N.a,{name:"lines.".concat(e.index,".amount"),component:"div",className:"field-error"})]})}function P(e){return Object(n.jsxs)("div",{children:[Object(n.jsxs)(f.a,{children:[Object(n.jsx)(N.b,{as:v.a.Control,name:"lines.".concat(e.index,".tax"),type:"number",min:"0",step:"0.001"}),Object(n.jsx)(f.a.Append,{children:Object(n.jsx)(f.a.Text,{children:"%"})})]}),Object(n.jsx)(N.a,{name:"lines.".concat(e.index,".tax"),component:"div",className:"field-error"})]})}function A(e){return Object(n.jsxs)("div",{children:[Object(n.jsx)(N.b,{as:v.a.Check,type:"checkbox",id:"lines.".concat(e.index,".usage"),name:"lines.".concat(e.index,".usage")}),Object(n.jsx)(N.a,{name:"lines.".concat(e.index,".usage"),component:"div",className:"field-error"})]})}var H=function(e){var t=e.values.lines.map((function(t,a){return Object(n.jsxs)("tr",{children:[Object(n.jsx)("td",{children:Object(n.jsx)(I,{index:a})}),Object(n.jsx)("td",{children:Object(n.jsx)(B,{index:a})}),Object(n.jsx)("td",{children:Object(n.jsx)(P,{index:a})}),Object(n.jsx)("td",{children:Object(n.jsx)(A,{index:a})}),Object(n.jsx)("td",{children:Object(n.jsx)(D,{index:a,values:e.values.lines,arrayHelpers:e.arrayHelpers})})]},a)}));return Object(n.jsx)("div",{className:"d-inline",children:Object(n.jsxs)(k.a,{striped:!0,bordered:!0,hover:!0,children:[Object(n.jsx)("thead",{children:Object(n.jsxs)("tr",{children:[Object(n.jsx)("th",{scope:"col",children:"Name"}),Object(n.jsx)("th",{scope:"col",children:"Amount"}),Object(n.jsx)("th",{scope:"col",children:"Tax"}),Object(n.jsx)("th",{scope:"col",children:"Usage"}),Object(n.jsx)("th",{scope:"col",children:Object(n.jsx)("span",{className:"sr-only",children:"Actions"})})]})}),Object(n.jsx)("tbody",{children:t})]})})},J=a(10),V=a(54),F=a.n(V);var M=function(e){var t=Object(N.g)().setFieldValue,a=Object(N.f)(e),l=Object(s.a)(a,1)[0];return Object(n.jsx)(F.a,Object(w.a)(Object(w.a)(Object(w.a)({},l),e),{},{onChange:function(e){return t(l.name,e)}}))};function L(e){return Object(n.jsxs)("div",{children:[Object(n.jsx)(N.b,{as:v.a.Control,name:"people.".concat(e.index,".name"),type:"text",required:!0}),Object(n.jsx)(N.a,{name:"people.".concat(e.index,".name"),component:"div",className:"field-error"})]})}function E(e){return Object(n.jsxs)("div",{children:[Object(n.jsx)(N.b,{as:M,name:"people.".concat(e.index,".dateRange"),maxDate:J.DateTime.local().toJSDate(),calendarIcon:Object(n.jsx)("i",{className:"bi-calendar-range-fill"}),clearIcon:Object(n.jsx)("i",{className:"bi-x-square"})}),Object(n.jsx)(N.a,{name:"people.".concat(e.index,".start"),component:"div",className:"field-error"})]})}var $=function(e){var t=e.values.people.map((function(t,a){return Object(n.jsxs)("tr",{children:[Object(n.jsx)("td",{children:Object(n.jsx)(L,{index:a})}),Object(n.jsx)("td",{children:Object(n.jsx)(E,{index:a})}),Object(n.jsx)("td",{children:Object(n.jsx)(D,{index:a,values:e.values.people,arrayHelpers:e.arrayHelpers})})]},a)}));return Object(n.jsx)("div",{className:"d-inline",children:Object(n.jsxs)(k.a,{striped:!0,bordered:!0,hover:!0,children:[Object(n.jsx)("thead",{children:Object(n.jsxs)("tr",{children:[Object(n.jsx)("th",{scope:"col",children:"Name"}),Object(n.jsx)("th",{scope:"col",children:"Date Range"}),Object(n.jsx)("th",{scope:"col",children:Object(n.jsx)("span",{className:"sr-only",children:"Actions"})})]})}),Object(n.jsx)("tbody",{children:t})]})})},z=a(48),U=a.n(z),q=a(14),G=a.n(q),W=function e(t,a){Object(b.a)(this,e),this.name=t,this.period=a},K=function e(){Object(b.a)(this,e),this.name="",this.taxRate=0,this.amount=new G.a(0),this.split=!0},Q=function(){function e(t,a){Object(b.a)(this,e),this.usageTotal=t,this.generalTotal=a}return Object(h.a)(e,[{key:"total",value:function(){return this.usageTotal.add(this.generalTotal)}}]),e}(),X=function(e){Object(d.a)(a,e);var t=Object(j.a)(a);function a(e,n,l){var c;return Object(b.a)(this,a),(c=t.call(this,n,l)).name=e,c}return a}(Q),Y=function(){function e(){Object(b.a)(this,e),this.lines=[],this.totalAmount=new G.a(0)}return Object(h.a)(e,[{key:"total",value:function(){if(0===this.lines.length)return new Q(new G.a(0),new G.a(0));var t=this.lines.filter((function(e){return e.split})),a=this.lines.filter((function(e){return!e.split}));if(0===t.length){var n=new K;n.split=!0,t.push(n)}if(0===a.length){var l=new K;l.split=!1,a.push(l)}e._applyTax(t),e._applyTax(a);var c=e._accumulate(t),r=e._accumulate(a);return new Q(c,r)}},{key:"split",value:function(e,t,a){if(0===a.size)return[];for(var n=this.total(),l=n.usageTotal.div(e.length("days")),c=Array.from(U.a.mark((function t(){var a;return U.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a=0;case 1:if(!(a<e.length("days"))){t.next=7;break}return t.next=4,e.start.plus({days:a});case 4:++a,t.next=1;break;case 7:case"end":return t.stop()}}),t)}))()),r=new Map,i=0,s=0,o=c;s<o.length;s++){var d,j=o[s],b=0,h=Object(u.a)(t);try{for(h.s();!(d=h.n()).done;){var x=d.value;null!==x.period&&x.period.contains(j)&&b++}}catch(B){h.e(B)}finally{h.f()}0===b&&(b=a.size,i++),r.set(j,b)}for(var m=l.div(a.size).times(i),O=new Map,p=0,v=c;p<v.length;p++){var f=v[p];O.set(f,l.div(r.get(f)))}var y,g=n.generalTotal.div(a.size),k=[],N=Object(u.a)(a);try{for(N.s();!(y=N.n()).done;){var w,R=y.value,T=new G.a(0).plus(m),S=Object(u.a)(t);try{for(S.s();!(w=S.n()).done;){var _=w.value;if(_.name===R){var C,D=Object(u.a)(c);try{for(D.s();!(C=D.n()).done;){var I=C.value;null!==_.period&&_.period.contains(I)&&(T=T.plus(O.get(I)))}}catch(B){D.e(B)}finally{D.f()}}}}catch(B){S.e(B)}finally{S.f()}k.push(new X(R,T,g))}}catch(B){N.e(B)}finally{N.f()}return k}},{key:"valid",value:function(){return this.total().total().minus(this.totalAmount).abs().round(2).gte(.001)?"Bill total not equal to the sum of the lines.":""}}],[{key:"_applyTax",value:function(e){var t,a=Object(u.a)(e);try{for(a.s();!(t=a.n()).done;){var n=t.value;n.amount=n.amount.times(n.taxRate+1)}}catch(l){a.e(l)}finally{a.f()}}},{key:"_accumulate",value:function(e){var t,a=new G.a(0),n=Object(u.a)(e);try{for(n.s();!(t=n.n()).done;){var l=t.value;a=a.plus(l.amount)}}catch(c){n.e(c)}finally{n.f()}return a}}]),e}();var Z=function(e){if(0===e.portions.length)return null;var t=e.portions.map((function(e){return Object(n.jsxs)("tr",{children:[Object(n.jsx)("td",{children:e.name}),Object(n.jsxs)("td",{children:["$",e.generalTotal.round(2).toFixed(2)]}),Object(n.jsxs)("td",{children:["$",e.usageTotal.round(2).toFixed(2)]}),Object(n.jsxs)("td",{children:["$",e.generalTotal.plus(e.usageTotal).round(2).toFixed(2)]})]},e.name)}));return Object(n.jsxs)(k.a,{striped:!0,bordered:!0,hover:!0,children:[Object(n.jsx)("thead",{children:Object(n.jsxs)("tr",{children:[Object(n.jsx)("th",{children:"Name"}),Object(n.jsx)("th",{children:"General"}),Object(n.jsx)("th",{children:"Usage"}),Object(n.jsx)("th",{children:"Total"})]})}),Object(n.jsx)("tbody",{children:t})]})},ee=a.p+"static/media/app-icon.93bc18a9.svg",te={bill:{total:0,dateRange:[J.DateTime.local().minus({months:1}).toJSDate(),J.DateTime.local().toJSDate()]},lines:[{name:"",amount:0,tax:0,usage:!0}],people:[{name:"",dateRange:[J.DateTime.local().minus({months:1}).toJSDate(),J.DateTime.local().toJSDate()]}]},ae=function(){function e(){Object(b.a)(this,e)}return Object(h.a)(e,null,[{key:"_dateFromISO",value:function(e){return null===e?e:J.DateTime.fromISO(e)}},{key:"toValues",value:function(t){var a=t.searchParams.get(e._paramName);if(null===a)return null;try{var n=JSON.parse(a);n.bill.dateRange=n.bill.dateRange.map(this._dateFromISO);var l,c=Object(u.a)(n.people);try{for(c.s();!(l=c.n()).done;){var r=l.value;null!==r.dateRange&&(r.dateRange=r.dateRange.map(this._dateFromISO))}}catch(i){c.e(i)}finally{c.f()}return n}catch(s){return null}}},{key:"fromValues",value:function(t){var a=new URL(document.location),n=JSON.stringify(t,(function(e,t){if(!e.startsWith("_"))return t}),null);return a.searchParams.set(e._paramName,n),a}}]),e}();ae._paramName="data";var ne=function(e){Object(d.a)(a,e);var t=Object(j.a)(a);function a(e){var n;return Object(b.a)(this,a),(n=t.call(this,e)).state={bill:new Y,results:[]},n.handleCalculate=n.handleCalculate.bind(Object(o.a)(n)),n.handleSubmit=n.handleSubmit.bind(Object(o.a)(n)),n.handlePermalink=n.handlePermalink.bind(Object(o.a)(n)),n.validate=n.validate.bind(Object(o.a)(n)),n}return Object(h.a)(a,[{key:"handleCalculate",value:function(e){var t=this.createBill(e),a=this.createPeople(e),n=Object(s.a)(a,2),l=n[0],c=n[1],r=t.split(J.Interval.fromDateTimes(e.bill.dateRange[0],e.bill.dateRange[1]),c,l);this.setState({results:r})}},{key:"handlePermalink",value:function(e){var t=ae.fromValues(e),a=document.getElementById("permalink-display");a.getElementsByTagName("input")[0].value=t.toString(),a.classList.remove("invisible")}},{key:"copyPermalink",value:function(){var e=document.getElementById("permalink-display").getElementsByTagName("input")[0],t=document.designMode;document.designMode="on",e.select(),document.execCommand("copy",!1,e.value),document.designMode=t}},{key:"handleSubmit",value:function(e,t){var a=e._submitButton;"calculate"===a?this.handleCalculate(e,t):"permalink"===a&&this.handlePermalink(e,t),t.setSubmitting(!1)}},{key:"validate",value:function(e){var t={},a=this.createBill(e).valid();a.length>0&&(t.lines=a);var n,l=J.Interval.fromDateTimes(e.bill.dateRange[0],e.bill.dateRange[1]),c=Object(u.a)(e.people);try{for(c.s();!(n=c.n()).done;){var r=n.value;if(null!==r.dateRange){var i=J.Interval.fromDateTimes(r.dateRange[0],r.dateRange[1]);if(!l.engulfs(i)){t.people=r.name+" has dates outside the bill date range.";break}}}}catch(s){c.e(s)}finally{c.f()}return t}},{key:"createBill",value:function(e){var t=new Y;t.totalAmount=new G.a(e.bill.total);var a,n=Object(u.a)(e.lines);try{for(n.s();!(a=n.n()).done;){var l=a.value,c=new K;c.name=l.name,c.amount=new G.a(l.amount),c.taxRate=l.tax/100,c.split=l.usage,t.lines.push(c)}}catch(r){n.e(r)}finally{n.f()}return t}},{key:"createPeople",value:function(e){var t,a=new Set,n=[],l=Object(u.a)(e.people);try{for(l.s();!(t=l.n()).done;){var c=t.value;a.add(c.name);var r=null;null!==c.dateRange&&(r=Array.isArray(c.dateRange)?J.Interval.fromDateTimes(c.dateRange[0],c.dateRange[1]):J.Interval.after(c.dateRange,{days:1})),n.push(new W(c.name,r))}}catch(i){l.e(i)}finally{l.f()}return[a,n]}},{key:"render",value:function(){var e,t=this,a=null!==(e=ae.toValues(new URL(document.location)))&&void 0!==e?e:te;return a._submitButton="",Object(n.jsxs)("div",{children:[Object(n.jsx)(x.a,{bg:"dark",variant:"dark",children:Object(n.jsxs)(x.a.Brand,{children:[Object(n.jsx)("img",{alt:"",src:ee,width:"30",height:"30",className:"d-inline-block align-top"})," ","Split Bill"]})}),Object(n.jsx)(m.a,{children:Object(n.jsx)(N.e,{initialValues:a,validate:this.validate,onSubmit:this.handleSubmit,children:function(e){return Object(n.jsx)("div",{children:Object(n.jsxs)(N.d,{children:[Object(n.jsx)(O.a,{children:Object(n.jsxs)(p.a,{children:[Object(n.jsx)("h1",{children:"Bill"}),Object(n.jsxs)(v.a.Row,{children:[Object(n.jsxs)(v.a.Group,{as:p.a,controlId:"bill.total",children:[Object(n.jsx)(v.a.Label,{children:"Total"}),Object(n.jsxs)(f.a,{children:[Object(n.jsx)(f.a.Prepend,{children:Object(n.jsx)(f.a.Text,{children:"$"})}),Object(n.jsx)(N.b,{as:v.a.Control,name:"bill.total",type:"number",min:"0",step:"0.01"})]})]}),Object(n.jsxs)(v.a.Group,{as:p.a,controlId:"bill.dateRange",children:[Object(n.jsx)(v.a.Label,{children:"Date Range"}),Object(n.jsx)(N.b,{as:M,name:"bill.dateRange",maxDate:J.DateTime.local().toJSDate(),calendarIcon:Object(n.jsx)("i",{className:"bi-calendar-range-fill"}),clearIcon:null})]})]})]})}),Object(n.jsx)(O.a,{children:Object(n.jsxs)(p.a,{children:[Object(n.jsx)("h1",{children:"People"}),Object(n.jsx)(N.c,{name:"people",children:function(t){return Object(n.jsx)($,{values:e.values,arrayHelpers:t})}}),e.errors.people&&Object(n.jsx)(y.a,{variant:"danger",children:e.errors.people})]})}),Object(n.jsx)(O.a,{children:Object(n.jsxs)(p.a,{children:[Object(n.jsx)("h1",{children:"Lines"}),Object(n.jsx)(N.c,{name:"lines",children:function(t){return Object(n.jsx)(H,{values:e.values,arrayHelpers:t})}}),e.errors.lines&&Object(n.jsx)(y.a,{variant:"danger",children:e.errors.lines})]})}),Object(n.jsx)(O.a,{children:Object(n.jsxs)(p.a,{children:[Object(n.jsx)("h1",{children:"Results"}),Object(n.jsxs)("div",{className:"result-buttons",children:[Object(n.jsx)(g.a,{className:"result-buttons__calculate",variant:"primary",type:"submit",disabled:e.isSubmitting||e.isValidating||!e.isValid,onClick:function(){return e.setFieldValue("_submitButton","calculate")},children:"Calculate"}),Object(n.jsx)(g.a,{className:"result-buttons__permalink",variant:"secondary",type:"submit",disabled:e.isSubmitting,onClick:function(){return e.setFieldValue("_submitButton","permalink")},children:"Create Permalink"}),Object(n.jsxs)(f.a,{id:"permalink-display",className:"result-buttons__permalink__display invisible",children:[Object(n.jsx)(v.a.Control,{type:"text"}),Object(n.jsx)(f.a.Append,{children:Object(n.jsxs)(g.a,{variant:"outline-primary",type:"button",onClick:t.copyPermalink,children:[Object(n.jsx)("span",{className:"sr-only",children:"Copy"}),Object(n.jsx)("i",{className:"bi-clipboard"})]})})]})]}),Object(n.jsx)(Z,{portions:t.state.results})]})})]})})}})})]})}}]),a}(c.a.Component);i.a.render(Object(n.jsx)(c.a.StrictMode,{children:Object(n.jsx)(ne,{})}),document.getElementById("root"))}},[[85,1,2]]]);
//# sourceMappingURL=main.d51db658.chunk.js.map